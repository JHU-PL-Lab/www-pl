<!DOCTYPE HTML>
<!--
 Solarize by TEMPLATED
 templated.co @templatedco
 Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>
 <head>
  <title>Principles of Programming Languages</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="description" content="" />
  <meta name="keywords" content="" />
  <!--[if lte IE 8]><script src="/pl/css/ie/html5shiv.js"></script><![endif]-->
  <script src="/pl/js/jquery.min.js"></script>
  <script src="/pl/js/jquery.dropotron.min.js"></script>
  <script src="/pl/js/skel.min.js"></script>
  <script src="/pl/js/skel-layers.min.js"></script>
  <script src="/pl/js/init.js"></script>
  <noscript>
   <link rel="stylesheet" href="/pl/css/skel.css" />
   <link rel="stylesheet" href="/pl/css/style.css" />
  </noscript>
  <!--[if lte IE 8]><link rel="stylesheet" href="/pl/css/ie/v8.css" /><![endif]-->
 </head>
 <body>

  <!-- Header Wrapper -->
   <div class="wrapper style1">
   
   <!-- Header -->
    <div id="header">
     <div class="container">
       
      <!-- Logo -->
       <h1><a href="/pl/index.html" id="logo">Principles of PL</a></h1>
      
      <!-- Nav -->
       <nav id="nav">
        <ul>
         <li class="active"><a href="/pl/index.html">Home</a></li>
         <li>
          <a href="/pl/logistics.html">Logistics</a>
          <ul class="menu">
           <li><a href="/pl/dateline.html">Dateline</a></li>
           <li><a href="https://gradescope.com">Gradescope</a></li>
           <li><a href="https://campuswire.com/c/G9E051068">Q&amp;A</a></li>
           <li><a href="/pl/contact.html">Contact Us</a></li>
          </ul>
         </li>
         <li><a href="/pl/book">The Book</a>
         <ul class="menu">
         <li><a href="/pl/book/book.pdf">The book PDF</a></li>
         <li><a href="/pl/book/dist/">The FbDK dist</a></li>
       </ul></li>

         <li><a href="/pl/ocaml/index.html">OCaml</a>
         </li>
         <li><a href="">Assignments</a>
         <ul class="menu">
         <li><a href="/pl/assignments/assignment1.html">Assignment 1</a></li>
         <li><a href="/pl/assignments/assignment2.html">Assignment 2</a></li>
         <li><a href="/pl/assignments/assignment3.html">Assignment 3</a></li>
         <li><a href="/pl/assignments/assignment4.html">Assignment 4</a></li>
         <li><a href="/pl/assignments/assignment5.html">Assignment 5</a></li>
         <li><a href="/pl/assignments/assignment6.html">Assignment 6</a></li>
         <li><a href="/pl/assignments/assignment7.html">Assignment 7</a></li>
         <li><a href="/pl/assignments/assignment8.html">Assignment 8</a></li>
         <li><a href="/pl/assignments/assignment9.html">Assignment 9</a></li>
       </ul></li>
        </ul>
       </nav>
 
     </div>
    </div>
<!-- close-out code before the standard footer .. use to glue in raw html. -->
</div>
<!-- Main -->
<div id="main" class="wrapper style4">
<!-- Content -->
<div id="content" class="container">
<section>

<link rel="stylesheet" href="/pl/css/friendly.css" />
<meta charset="utf-8" />
    <h2 id="assigment-9---type-inferencer-implementation">Assigment 9 - Type Inferencer Implementation</h2>
<h2 id="draft--final-assignment-may-differ">DRAFT!  Final assignment may differ!!</h2>

<p>The FbDK has been designed to be extensible with typechecking. It is just turned off by default. For Part-I of the homework, use the FbDK to implement the type inference algorithm for <strong>EFb</strong> in OCaml. Your implementation is expected to handle all of <strong>EFb</strong> with the exception of <code>Let Rec</code>.</p>

<p>To complete this assignment, you will need to edit <code>fbtype.ml</code> in the <code>Fb/</code> directory and implement the <code>typecheck</code> function which in the dist is just raising an exception. This function must return the type of that expression as specified by the <strong>EFb</strong> algorithm; you should use the <code>fbtype</code> data type which appears in <code>fbast.ml</code>. You also should set <code>typecheck_default_enabled</code> to <code>true</code> in <code>fbtype.ml</code> so the typechecker will run.</p>

<p>For this part, you should turn in your <code>fbtype.ml</code> file and nothing else. Do not change <code>fbast.ml</code> or similar files, since your code will be auto-graded by dropping your <code>fbtype.ml</code> file into a correct implementation of <strong>Fb</strong>.</p>

<p>You can directly invoke the typechecker function <code>typecheck</code> in the top loop, either your own or the reference depending on whether you did a <code>dune utop ./Fb</code> or a <code>./reference/Fb/toplevel.exe</code>:</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">$</span> <span class="o">./</span><span class="n">reference</span><span class="o">/</span><span class="nc">Fb</span><span class="o">/</span><span class="n">toplevel</span><span class="o">.</span><span class="n">exe</span>
<span class="o">...</span>
<span class="o">#</span> <span class="k">open</span> <span class="nc">Fbdk</span><span class="p">;;</span>
<span class="o">#</span> <span class="k">open</span> <span class="nc">Ast</span><span class="p">;;</span>
<span class="o">#</span> <span class="k">open</span> <span class="nc">Typechecker</span><span class="p">;;</span>
<span class="o">#</span> <span class="k">open</span> <span class="nc">Pp</span><span class="p">;</span>
<span class="o">#</span> <span class="k">open</span> <span class="nc">Debugutils</span><span class="p">;;</span>
<span class="o">#</span> <span class="n">typecheck</span> <span class="o">@@</span> <span class="n">parse</span> <span class="s2">"Fun x -&gt; x"</span><span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="n">fbtype</span> <span class="o">=</span> <span class="nc">TArrow</span> <span class="p">(</span><span class="nc">TVar</span> <span class="s2">"a"</span><span class="o">,</span> <span class="nc">TVar</span> <span class="s2">"a"</span><span class="p">)</span>
<span class="o">#</span> <span class="k">let</span> <span class="n">tc</span>  <span class="n">s</span> <span class="o">=</span> <span class="n">show_fbtype</span> <span class="o">@@</span> <span class="n">typecheck</span> <span class="o">@@</span> <span class="n">parse</span> <span class="n">s</span><span class="p">;;</span>
<span class="k">val</span> <span class="n">tc</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">-&gt;</span> <span class="kt">string</span> <span class="o">=</span> <span class="o">&lt;</span><span class="k">fun</span><span class="o">&gt;</span>
<span class="o">#</span> <span class="n">tc</span> <span class="s2">"Fun x -&gt; x"</span><span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">=</span> <span class="s2">"a -&gt; a"</span>
</code></pre></div></div>

<p>The <code>Fb</code> reference binary also supports typechecking. You can turn it on by passing <code>--typecheck</code> to it. As an example, a correctly working interpreter should behave as follows:</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">$</span> <span class="o">./</span><span class="nc">Fb</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">interpreter</span><span class="o">.</span><span class="n">exe</span> <span class="o">--</span><span class="n">typecheck</span>
        <span class="nc">Fb</span> <span class="n">version</span> <span class="mi">1</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">0</span>                <span class="p">(</span><span class="n">typechecker</span> <span class="n">enabled</span><span class="p">)</span>
<span class="o">#</span> <span class="p">(</span><span class="nc">Function</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="nc">Function</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="mi">4</span><span class="p">;;</span>
<span class="o">:</span> <span class="nc">Int</span> <span class="o">-&gt;</span> <span class="nc">Int</span>
<span class="o">==&gt;</span> <span class="nc">Function</span> <span class="n">y</span> <span class="o">-&gt;</span>
<span class="mi">4</span> <span class="o">+</span> <span class="n">y</span>
<span class="o">#</span> <span class="nc">Function</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="p">;;</span>    
<span class="o">:</span> <span class="k">'</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">'</span><span class="n">a</span>
<span class="o">==&gt;</span> <span class="nc">Function</span> <span class="n">x</span> <span class="o">-&gt;</span>
<span class="n">x</span>
<span class="o">#</span> <span class="nc">True</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;;</span>
<span class="nc">Exception</span><span class="o">:</span> <span class="nn">Fbtype</span><span class="p">.</span><span class="nc">TypeInferenceFailure</span><span class="p">(</span><span class="s2">"immediately inconsistent types"</span><span class="p">)</span>
</code></pre></div></div>

<p>Note also that the exception which is raised by a type error is defined in the <code>fbtype.ml</code> module; you must define your own exception(s) to throw when the expression cannot be assigned a type.</p>

<p>You need to implement the full algorithm <em>except</em> you do not need to implement the cycle detection algorithm - your checker can loop forever on programs with cyclic constraints (but only on such programs). Extra credit will be given for implementing cycle detection. Also, you don’t need to include the let-polymorphism of <strong>PEFb</strong>.</p>

<p>Here are some suggestions:</p>

<ul>
  <li>Break down your implementation into the same phases as in lecture and the book:
    <ol>
      <li>Generate the type <code>τ \ E</code> using the ideas in the type system (and also following the typechecker for <code>TFb</code> in the book),</li>
      <li>Perform the closure on <code>E</code>,</li>
      <li>Check the closure for immediate inconsistencies, and</li>
      <li>Substitute equations of <code>E</code> into <code>τ</code> to solve.</li>
    </ol>
  </li>
  <li>The <code>E</code> is a set of pairs (the type equations τ = τ’); built-in Caml types such as <code>Set</code> or <code>Map</code> may prove useful in your implementation of this data structure. You can use any of the built-in libraries but the auto-grader cannot install any extra packages to run your type checker.</li>
  <li>In the closure outlined in the book, we assumed = was symmetric; in your implementation, one easy (but inefficient) method to achieve this to add an additional closure step: every time you add τ = τ’ to the closure, also add τ’ = τ.</li>
  <li>The “substitute to solve” phase is the same idea as your substitution function you wrote on terms; just do it on types.</li>
  <li>During testing, it may be useful to run your interpreter with the <code>--show-backtrace</code>. This will give you a stack trace for any exceptions that occur. Unfortunately this feature works only on the compiled binary and not in the interpreter.</li>
  <li>Don’t worry about efficiency. <strong>Do</strong> worry about correctness.</li>
</ul>
      
          </section>
        </div>
      </div>

				<div id="copyright">
					Web Design: <a href="http://templated.co">TEMPLATED</a> Images: <a href="http://unsplash.com">Unsplash</a> (<a href="http://unsplash.com/cc0">CC0</a>)
				</div>			


   </body>
</html>
