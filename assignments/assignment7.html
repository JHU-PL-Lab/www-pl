<!DOCTYPE HTML>
<!--
 Solarize by TEMPLATED
 templated.co @templatedco
 Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>
 <head>
  <title>Principles of Programming Languages</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="description" content="" />
  <meta name="keywords" content="" />
  <!--[if lte IE 8]><script src="/pl/css/ie/html5shiv.js"></script><![endif]-->
  <script src="/pl/js/jquery.min.js"></script>
  <script src="/pl/js/jquery.dropotron.min.js"></script>
  <script src="/pl/js/skel.min.js"></script>
  <script src="/pl/js/skel-layers.min.js"></script>
  <script src="/pl/js/init.js"></script>
  <noscript>
   <link rel="stylesheet" href="/pl/css/skel.css" />
   <link rel="stylesheet" href="/pl/css/style.css" />
  </noscript>
  <!--[if lte IE 8]><link rel="stylesheet" href="/pl/css/ie/v8.css" /><![endif]-->
 </head>
 <body>

  <!-- Header Wrapper -->
   <div class="wrapper style1">
   
   <!-- Header -->
    <div id="header">
     <div class="container">
       
      <!-- Logo -->
       <h1><a href="/pl/index.html" id="logo">Principles of PL</a></h1>
      
      <!-- Nav -->
       <nav id="nav">
        <ul>
         <li class="active"><a href="/pl/index.html">Home</a></li>
         <li>
          <a href="/pl/logistics.html">Logistics</a>
          <ul class="menu">
          <li><a href="/pl/logistics.html">Overview</a></li>
           <li><a href="/pl/dateline.html">Dateline</a></li>
           <li><a href="https://gradescope.com">Gradescope</a></li>
           <li><a href="https://courselore.org/courses/8986607496">Q&amp;A</a></li>
           <li><a href="/pl/contact.html">Contact Us</a></li>
          </ul>
         </li>
         <li><a href="/pl/book">The Book</a>
         <ul class="menu">
         <li><a href="/pl/book/book.pdf">The book PDF</a></li>
         <li><a href="/pl/book/dist/">The FbDK dist</a></li>
       </ul></li>

         <li><a href="/pl/ocaml/index.html">OCaml</a>
         </li>
         <li><a href="">Assignments</a>
         <ul class="menu">
         <li><a href="/pl/assignments/assignment1.html">Assignment 1</a></li>
         <li><a href="/pl/assignments/assignment2.html">Assignment 2</a></li>
         <li><a href="/pl/assignments/assignment3.html">Assignment 3</a></li>
         <li><a href="/pl/assignments/assignment4.html">Assignment 4</a></li>
         <li><a href="/pl/assignments/assignment5.html">Assignment 5</a></li>
         <li><a href="/pl/assignments/assignment6.html">Assignment 6</a></li>
         <li><a href="/pl/assignments/assignment7.html">Assignment 7</a></li>
         <li><a href="/pl/assignments/assignment8.html">Assignment 8</a></li>
         <li><a href="/pl/assignments/assignment9.html">Assignment 9</a></li>
       </ul></li>
        </ul>
       </nav>
 
     </div>
    </div>
<!-- close-out code before the standard footer .. use to glue in raw html. -->
</div>
<!-- Main -->
<div id="main" class="wrapper style4">
<!-- Content -->
<div id="content" class="container">
<section>

<link rel="stylesheet" href="/pl/css/friendly.css" />
<meta charset="utf-8" />
    <h2 id="assigment-7-actors">Assigment 7: Actors</h2>

<p>This homework focuses on the actor model and actor programming in <strong>AFbV</strong>.  The AFbV examples run in class may be found in the <a href="../ocaml/afbv_examples.ml"><code>afbv_examples.ml</code></a> file.</p>

<p>This file also contains instructions on how to run the reference interpreter and to set up utop for easy testing of your actor code.  As a warm-up, turn on some of the debugging flags in comments at the top and <code>peu</code> some of the examples in that file. (Note that the message debug flag was recently fixed so if you want to use that please grab a fresh copy of the zip file to get the latest reference implementation (only the file <code>./reference/AFbV/toplevel.exe</code> is changed).)</p>

<p>For this assignment you are going to write a set data structure in AFbV.   For all the questions, include the answers in a file <code>assignment7.ml</code> as let-defined strings (or as OCaml comments for the written questions).</p>

<p>a. For your first implementation, the set actor should respond to the following messages:</p>
<ul>
  <li><code>`add(v)</code> - add value <code>v</code> to the set (ignore if <code>v</code> is already in the set)</li>
  <li><code>`delete(v)</code> - delete value <code>v</code> from the set (ignore if <code>v</code> is not in the set)</li>
  <li><code>`isempty(a)</code> -  If the set is empty, send <code>a &lt;- True</code>; if not, in the set send <code>a &lt;- False</code></li>
  <li><code>`contains(v,a)</code> - if <code>v</code> is in the set, send <code>a &lt;- True</code>; if <code>v</code> is not in the set, send <code>a &lt;- False</code></li>
</ul>

<p>Note that <strong>AFbV</strong> has lists which can be used for implementing your set.  There is no pattern-matching on lists however, you must use <code>Head(..)</code> and <code>Tail(..)</code> to access the head and tail, and <code>..= []</code> to test for an empty list.  You can write lists as <code>[1;2;3]</code> and consing with <code>::</code> just like in OCaml.  AFbV also has pairs, as can be seen in the <code>`contains</code> message above.  <code>Fst</code> and <code>Snd</code> extract the first and second components of a pair, respectively.</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="k">let</span> <span class="n">a7a</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">=</span> <span class="c">(* YOUR SET BEHAVIOR HERE as a string *)</span><span class="p">;;</span>
</code></pre></div></div>

<p>Here is a sample runner which will send a few messages to your set.</p>
<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="k">let</span> <span class="n">a7a_tester</span> <span class="o">=</span> 
   <span class="s2">"Let set_beh = ("</span><span class="o">^</span><span class="n">a7a</span><span class="o">^</span><span class="s2">")  In
   Let test_beh = Fun me -&gt; Fun _ -&gt; Fun _ -&gt;  
     Let s = Create(set_beh,[]) (* The [] here is a dummy like () in OCaml *) In
       (s &lt;- `add(1)); (s &lt;- `delete(1)); (s &lt;- `add(3)); (s &lt;- `contains(3,me));
       Fun m -&gt; (Print </span><span class="se">\"</span><span class="s2">contains(3) returned </span><span class="se">\"</span><span class="s2">); (Print (m))
   In Let test = Create(test_beh,0)
   In test &lt;- []"</span><span class="p">;;</span>
</code></pre></div></div>

<p>b. Unfortunately the above API we gave you is not a good one: it violates what you would expect out of set behavior since it can shuffle the order that messages are processed in.  One property of actors discussed in class was arrival order nondeterminism, namely messages need not arrive in the order they were sent (you need to set <code>deterministic_delivery := true;;</code> to make things deterministic; <strong>AFbV</strong> by default is non-deterministic).  Describe how the above set actor API may not work properly, by giving a sequence of global actor states G0 -&gt; G1 -&gt; G2 of a computation involving the above set actor such that it is not functioning correctly as a set (even if the adding/removing/etc code is all locally correct).  Include your answer as a comment of the form</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="c">(* a7b. YOUR ANSWER *)</span>
</code></pre></div></div>
<p>in the <code>assignment7.ml</code> file.  Note that you can give your answer in the format <code>show_states := true</code> produces.  Please don’t include any of the actor code in your answers, “…” will do in place of any code.</p>

<p>c.  Another way to see why things may not work correctly is to consider how the initial <code>test &lt;- []</code> message gets processed: processing this message will be performed by a <code>e =S=&gt; v</code> relation as per the local actor stepping relation (defined in lecture and in 7.2.5 in the book).  Give what the <code>e</code>, <code>S</code>, and <code>v</code> will be in this case.  Answer this question in a comment again:</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="c">(* a7c. YOUR ANSWER *)</span>
</code></pre></div></div>

<p>To solve this problem, actors often need to explicitly send some sort of <code>`ack</code> message to indicate a task has completed, and the next action of the user of the data structure must be to listen for this <code>`ack</code> before performing another operation on the data structure.  The <code>count_server_eg</code> example in the examples file illustrates this behavior.</p>

<p>d. For this part, we will fix the above set API.  Concretely, we will add an actor (the “customer”) to which addition and deletion acknowledgements may be sent:</p>

<ul>
  <li><code>`add(v,a)</code> - add value <code>v</code> to the set (ignore if <code>v</code> is already in the set), <strong>and</strong> send <code>a &lt;- `ack([])</code></li>
  <li><code>`delete(v,a)</code> - delete value <code>v</code> from the set (ignore if <code>v</code> is not in the set), <strong>and</strong> send <code>a &lt;- `ack([])</code></li>
</ul>

<p>Concretely, add lines</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">a7d</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">=</span> <span class="c">(* YOUR REVISED SET BEHAVIOR HERE as a string *)</span><span class="p">;;</span>
</code></pre></div></div>

<p>which is the behavior of this improved set data structure and</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">a7d_tester</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">=</span> <span class="c">(* REVISED a7a_tester which tests a7d now *)</span><span class="s2">";;
</span></code></pre></div></div>

<p>to the <code>assignment7.ml</code> file which is a modification of the tester in a7a to perform the same sequence of add/delete/contains but using the fixed protocol.  In this case we should be guaranteed to get the correct result of <code>True</code> printed.</p>

<h3 id="submission">Submission</h3>

<p>Upload your <code>assignment7.ml</code> file to Gradescope.  The OCaml code in your file should only define the indicated strings, it should not run anything (no <code>peu</code> etc in it.)</p>
      
          </section>
        </div>
      </div>

				<div id="copyright">
					Web Design: <a href="http://templated.co">TEMPLATED</a> Images: <a href="http://unsplash.com">Unsplash</a> (<a href="http://unsplash.com/cc0">CC0</a>)
				</div>			


   </body>
</html>
